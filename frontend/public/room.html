<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Rooms | E-Hotel</title>
  <link rel="stylesheet" href="styles.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    .filter-group {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
      margin-bottom: 30px;
    }
    .filter-group select {
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 16px;
    }
    .room-card {
      display: none;
    }
  </style>
</head>
<body>

  <!-- NAVIGATION -->
  <header class="navbar">
    <a href="index.html">
      <img src="images/logo.png" alt="E-Hotel Logo" class="logo" />
    </a>
    <nav class="nav-links">
      <a href="index.html">Home</a>
      <a href="contact.html">Contact Us</a>
      <a href="room.html">Rooms</a>
      <a href="about.html">About Us</a>
      <a href="profile.html">Profile</a>
      <a href="login.htm"><button class="login-button">Login</button></a>
      <a href="hotel-statistics.html">Hotel Statistics</a>
    </nav>
  </header>

  <main class="rooms-section">
    <h1 class="page-title">Rooms</h1>

    <!-- Filter Section -->
    <div class="filter-group">
      <select id="capacityFilter" required>
        <option value="">Capacity</option>
        <option value="Single">Single</option>
        <option value="Double">Double</option>
        <option value="Family">Family</option>
        <option value="Suite">Suite</option>
      </select>

      <select id="viewFilter" required>
        <option value="">View</option>
        <option value="sea">Sea</option>
        <option value="mountain">Mountain</option>
        <option value="both">Both</option>
        <option value="none">None</option>
      </select>
      

      <select id="chainFilter" required>
        <option value="">Hotel Chain</option>
        <option value="Luxury Stays">Luxury Stays</option>
        <option value="Budget Inns">Budget Inns</option>
        <option value="Elite Resorts">Elite Resorts</option>
        <option value="Urban Hotels">Urban Hotels</option>
        <option value="Travel Comfort">Travel Comfort</option>
      </select>
      

      <select id="extendableFilter">
        <option value="">Extendable</option>
        <option value="yes">Yes</option>
        <option value="no">No</option>
      </select>
      <select id="countryFilter">
        <option value="">Country</option>
        <option value="Canada">Canada</option>
        <option value="Mexico">Mexico</option>
        <option value="USA">USA</option>
      </select>
               
    </div>

    <!-- Room Grid -->
    <section class="room-grid" id="roomGrid">
      <!-- Cards will be added here by JavaScript -->
    </section>
  </main>

  <script>
    const filters = {
      capacity: '',
      view: '',
      chain: '',
      extendable: '',
      country: ''
    };

    const capacityImages = {
      Single: 'images/Single.jpeg',
      Double: 'images/Double.jpeg',
      Family: 'images/Family.jpeg',
      Suite: 'images/Suite.jpeg',
    };
  
    const roomGrid = document.getElementById('roomGrid');
  
    const applyFilters = () => {
      const roomCards = document.querySelectorAll('.room-card'); // ðŸ”„ move this here
  
      roomCards.forEach(card => {
        const matches =
          (!filters.capacity || card.dataset.capacity === filters.capacity) &&
          (!filters.view || card.dataset.view === filters.view) &&
          (!filters.chain || card.dataset.chain === filters.chain) &&
          (!filters.extendable || card.dataset.extendable === filters.extendable)&&
          (!filters.country || card.dataset.country === filters.country);
        card.style.display = matches ? 'block' : 'none';
      });
    };
  
    let hotelsById = {};

    const fetchHotelsAndRooms = async () => {
      try {
        // Fetch hotel data first
        const hotelRes = await fetch('http://localhost:5001/hotel');
        const hotels = await hotelRes.json();

        // Map hotels by hotelid for fast lookup
        hotels.forEach(hotel => {
        hotelsById[hotel.hotelid] = hotel;
        });

        // Now fetch room data
        const roomRes = await fetch('http://localhost:5001/room');
        const rooms = await roomRes.json();

        roomGrid.innerHTML = '';

        rooms.forEach(room => {
          const imgSrc = capacityImages[room.capacity] || 'images/default.jpeg';

          const hotel = hotelsById[room.hotelid]; // ðŸ‘ˆ Match room to hotel
          

          const card = document.createElement('div');
          card.className = 'room-card';

          card.dataset.capacity = room.capacity;
          card.dataset.chain = hotel?.chainname?.trim() || 'Unknown';
          if (room.seaview && room.mountainview) {
            card.dataset.view = 'both';
          } else if (room.seaview) {
            card.dataset.view = 'sea';
          } else if (room.mountainview) {
            card.dataset.view = 'mountain';
          } else {
            card.dataset.view = 'none';
          }
          card.dataset.extendable = room.extendable ? 'yes' : 'no';
          card.dataset.country = hotel?.hotel_country?.trim() || '';

          card.innerHTML = `
          <img src="${imgSrc}" alt="${room.capacity} Room" class="room-image" />
          <h2 class="room-subheading">${hotel?.chainname || 'No Chain'} - ${room.capacity}</h2>
          <p class="room-text">
            Capacity: ${room.capacity}<br/>
            Category: ${hotel?.category || 'N/A'}<br/>
            Sea View: ${room.seaview ? 'Yes' : 'No'}<br/>
            Mountain View: ${room.mountainview ? 'Yes' : 'No'}<br/>
            Chain: ${hotel?.chainname || 'Unknown'}<br/>
            Location: ${hotel?.hotel_streetnumber || ''} ${hotel?.hotel_streetname || ''}, ${hotel?.hotel_city || ''}, ${hotel?.hotel_country || ''}
          </p>
          <div style="text-align: right; padding: 0 16px 16px;">
            <button class="btn">Book</button>
          </div>
        `;
        roomGrid.appendChild(card);
        });
    applyFilters();
  } catch (error) {
      console.error('Error fetching room data:', error);
    }
  };

  
    // Filter dropdowns
    document.getElementById('capacityFilter').addEventListener('change', e => {
      filters.capacity = e.target.value;
      applyFilters();
    });
    document.getElementById('viewFilter').addEventListener('change', e => {
      filters.view = e.target.value;
      applyFilters();
    });
    document.getElementById('chainFilter').addEventListener('change', e => {
      filters.chain = e.target.value;
      applyFilters();
    });
    document.getElementById('extendableFilter').addEventListener('change', e => {
      filters.extendable = e.target.value;
      applyFilters();
    });
    document.getElementById('countryFilter').addEventListener('change', e => {
      filters.country = e.target.value;
      applyFilters();
    });

    fetchHotelsAndRooms();
  </script>  
</body>
</html>
